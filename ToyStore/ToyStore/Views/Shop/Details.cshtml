@model dynamic
@{
    ViewData["Title"] = "Szczegóły - ToyStore";
    var id = Convert.ToInt32(ViewContext.RouteData.Values["id"]);
}

<hr />

<h3>Opinie klientów</h3>

@{
    var product = Model.Product as ToyStore.Model.DataModels.Product;
    var reviews = Model.Reviews as IEnumerable<ToyStore.Model.DataModels.Review>;
    double avg = Model.AverageRating;
}

@if (reviews != null && reviews.Any())
{
    <p>Średnia ocena: @avg.ToString("0.0") / 5</p>

    <ul class="list-group mb-4">
        @foreach (var r in reviews)
        {
            <li class="list-group-item">
                <strong>@r.AuthorName</strong>
                <span class="text-warning">
                    @for (int i = 0; i < r.Rating; i++)
                    {
                        @:<span>★</span>
                    }
                </span>
                <br />
                <small class="text-muted">
                    @r.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")
                </small>
                <p class="mb-0">@r.Content</p>
            </li>
        }
    </ul>
}
else
{
    <p>Ten produkt nie ma jeszcze opinii. Bądź pierwszą osobą, która ją doda!</p>
}

<h4>Dodaj opinię</h4>

<form asp-controller="Review" asp-action="Create" method="post">
    @Html.AntiForgeryToken()

    <input type="hidden" name="ProductId" value="@product.Id" />

    <div class="mb-3">
        <label for="AuthorName" class="form-label">Imię</label>
        <input type="text" name="AuthorName" id="AuthorName" class="form-control" required />
    </div>

    <div class="mb-3">
        <label for="Rating" class="form-label">Ocena (1–5)</label>
        <select name="Rating" id="Rating" class="form-select">
            @for (var i = 1; i <= 5; i++)
            {
                <option value="@i">@i</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label for="Content" class="form-label">Treść opinii</label>
        <textarea name="Content" id="Content" class="form-control" rows="4" required></textarea>
    </div>

    <button type="submit" class="btn btn-primary">Wyślij opinię</button>
</form>

<style>
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

    .btn-back {
        background-color: #28a745;
        color: white;
        font-size: 1.1rem;
        padding: 10px 25px;
        border: none;
        border-radius: 8px;
        transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
    }

        .btn-back:hover {
            transform: scale(1.1);
            background-color: #218838;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            color: white;
            text-decoration: none;
        }
</style>

<div class="container my-5">
    @if (id == 2)
    {
        <h1 class="text-center mb-4 text-primary">Nasze pluszowe misie</h1>
        <p class="text-center text-muted mb-5">Wybierz swojego ulubionego przyjaciela 🧸</p>

        <div class="row row-cols-1 row-cols-md-2 g-4">

            <!-- 🧸 Miś Ośmiornica -->
            <div class="col">
                <a asp-controller="Shop" asp-action="Product" asp-route-name="osmiornica" class="text-decoration-none text-dark">
                    <div class="card h-100 shadow-sm">
                        <img src="~/images/osmiornicayellow.png" class="card-img-top" alt="Miś Ośmiornica">
                        <div class="card-body text-center">
                            <h5 class="card-title">Miś Ośmiornica</h5>
                            <p class="card-text">Dwustronny miś – zmienia wyraz twarzy w zależności od nastroju!</p>
                        </div>
                    </div>
                </a>
            </div>

            <!-- 🐥 Miś Kurczak -->
            <div class="col">
                <a asp-controller="Shop" asp-action="Product" asp-route-name="kurczak" class="text-decoration-none text-dark">
                    <div class="card h-100 shadow-sm">
                        <img src="~/images/kurczakpink.png" class="card-img-top" alt="Miś Kurczak">
                        <div class="card-body text-center">
                            <h5 class="card-title">Miś Kurczak</h5>
                            <p class="card-text">Uroczy pluszak kurczak – idealny prezent dla najmłodszych.</p>
                        </div>
                    </div>
                </a>
            </div>

        </div>
    }
    else
    {
        <h1 class="text-center mb-4 text-primary">Szczegóły produktu</h1>
        <p class="text-center text-muted">Tutaj pojawi się opis wybranego produktu.</p>
    }

    <div class="text-center mt-5">
        <a asp-controller="Shop" asp-action="Index" class="btn-back">← Powrót do oferty</a>
    </div>
</div>
