@model ToyStore.Model.DataModels.Category

@{
    ViewData["Title"] = Model.Name;
}

<h2>@Model.Name</h2>

<div class="row">
    @foreach (var product in Model.Products)
    {
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm">
                <img src="@product.DefaultImageUrl" class="card-img-top" style="height:250px; object-fit:cover;" />
                <div class="card-body">
                    <h5 class="card-title">@product.Name</h5>
                    <p class="card-text">Cena: @product.Price.ToString("0.00") zł</p>

                    @* Kolory produktu *@
                    @if (product.ColorVariants.Any())
                    {
                        <div class="d-flex gap-2 flex-wrap mb-2">
                            @foreach (var color in product.ColorVariants)
                            {
                                <div class="color-swatch"
                                     title="@color.Color"
                                     style="background-color:@color.Color;"
                                     data-img="@color.ImageUrl"
                                     data-productid="@product.Id"
                                     onclick="selectColor(this)">
                                </div>
                            }
                        </div>
                    }

                    <a href="@Url.Action("Product", "Shop", new { id = product.Id })" class="btn btn-primary mt-2">Zobacz produkt</a>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        function selectColor(swatch) {
            const img = swatch.dataset.img;
            const card = swatch.closest('.card');
            const imgElement = card.querySelector('img');
            imgElement.src = img;

            // aktywne zaznaczenie koloru
            card.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            swatch.classList.add('active');
        }
    </script>
}

<style>
    .color-swatch {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        border: 2px solid #ccc;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
    }

        .color-swatch:hover {
            transform: scale(1.2);
            border-color: #007bff;
        }

        .color-swatch.active {
            border-color: #007bff;
            box-shadow: 0 0 5px #007bff;
        }
</style>
