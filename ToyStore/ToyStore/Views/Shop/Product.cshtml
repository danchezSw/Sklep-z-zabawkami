@model ToyStore.Web.Controllers.ProductModel

@{
    ViewData["Title"] = Model.Title;
    string initialImage = Url.Content(Model.DefaultImage);
}

<div class="container mt-4">
    <h2 class="text-center mb-4">@Model.Title</h2>

    <div class="row">
        <div class="col-md-6 text-center">
            <img id="productImage" src="@initialImage" class="img-fluid rounded shadow" style="max-height: 350px;" />
        </div>

        <div class="col-md-6">
            @* Kolory jeśli są *@
            @if (Model.Colors != null && Model.Colors.Count > 0)
            {
                <h4>Wybierz kolor:</h4>
                <div class="d-flex gap-2 flex-wrap mb-3">
                    @{
                        var firstColorKey = Model.Colors.Keys.First();
                    }
                    @foreach (var color in Model.Colors)
                    {
                        var activeClass = color.Key == firstColorKey ? "active" : "";
                        <div class="color-swatch @activeClass" title="@color.Key"
                             style="background-color:@color.Key;"
                             data-img="@Url.Content("~/images/" + color.Value)"
                             data-color="@color.Key">
                        </div>
                    }
                </div>
            }

            <form asp-controller="Shop" asp-action="AddToCart" method="post" class="mt-3">
                @Html.AntiForgeryToken()
                <input type="hidden" name="name" value="@Model.Title" />
                <input type="hidden" name="image" id="selectedImage" value="@initialImage" />
                <input type="hidden" name="color" id="selectedColor"
                       value="@(Model.Colors?.Keys.FirstOrDefault() ?? "")" />
                <input type="hidden" name="price" value="@Model.Price" />

                <div class="mt-3">
                    <label for="quantity" class="form-label">Ilość:</label>
                    <input type="number" id="quantity" name="quantity"
                           class="form-control" value="1" min="1" style="width:120px;" />
                </div>

                <button type="submit" class="btn btn-success btn-lg mt-3">
                    Dodaj do koszyka
                </button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const imgElement = document.getElementById("productImage");
        const selectedImageInput = document.getElementById("selectedImage");
        const selectedColorInput = document.getElementById("selectedColor");

        document.querySelectorAll(".color-swatch").forEach(swatch => {
            swatch.addEventListener("click", () => {
                const img = swatch.dataset.img;
                const color = swatch.dataset.color;
                imgElement.src = img;
                selectedImageInput.value = img;
                selectedColorInput.value = color;

                document.querySelectorAll(".color-swatch").forEach(s => s.classList.remove("active"));
                swatch.classList.add("active");
            });
        });
    </script>
}

<style>
    .color-swatch {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #ccc;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
    }

        .color-swatch:hover {
            transform: scale(1.2);
            border-color: #007bff;
        }

        .color-swatch.active {
            border-color: #007bff;
            box-shadow: 0 0 5px #007bff;
        }
</style>
