@model ToyStore.Model.DataModels.Product

@{
    ViewData["Title"] = Model.Name;
    string initialImage = Url.Content(Model.DefaultImageUrl ?? "~/images/no-image.png");
}

@functions {
    string ColorToCss(string color)
    {
        return color switch
        {
            "Niebieski" => "#0000ff",
            "Różowy" => "#ff69b4",
            "Żółty" => "#ffff00",
            "Fioletowy" => "#800080",
            "Czerwony" => "#ff0000",
            "Zielony" => "#008000",
            "Szary" => "#808080",
            "Biały" => "#ffffff",
            _ => "#ccc"
        };
    }
}

<div class="container mt-4">
    <h2 class="text-center mb-4">@Model.Name</h2>

    <div class="row">
        <div class="col-md-6 text-center">
            <img id="productImage" src="@initialImage" class="img-fluid rounded shadow" style="max-height: 350px;" />
        </div>

        <div class="col-md-6">
            @if (Model.ColorVariants != null && Model.ColorVariants.Any())
            {
                <h4>Wybierz wariant koloru:</h4>
                <div class="d-flex gap-2 flex-wrap mb-3">
                    @{
                        var firstVariant = Model.ColorVariants.First();
                    }
                    @foreach (var variant in Model.ColorVariants)
                    {
                        var activeClass = variant.Id == firstVariant.Id ? "active" : "";
                        <div class="color-swatch @activeClass" title="@variant.Color"
                             style="background-color:@ColorToCss(variant.Color);"
                             data-img="@Url.Content(variant.ImageUrl)"
                             data-variant="@variant.Id"
                             data-price="@variant.Price">
                        </div>
                    }
                </div>
            }

            <h4 class="text-success mt-3">Cena: <span id="productPrice">@Model.Price.ToString("0.00")</span> zł</h4>

            <form asp-controller="Shop" asp-action="AddToCart" method="post" class="mt-3">
                @Html.AntiForgeryToken()
                <input type="hidden" name="productId" value="@Model.Id" />
                <input type="hidden" name="colorVariantId" id="selectedVariantId" value="@(Model.ColorVariants.FirstOrDefault()?.Id ?? 0)" />
                <input type="hidden" name="price" id="selectedPrice" value="@Model.Price" />

                <div class="mt-3">
                    <label for="quantity" class="form-label">Ilość:</label>
                    <input type="number" id="quantity" name="quantity"
                           class="form-control" value="1" min="1" style="width:120px;" />
                </div>

                <button type="submit" class="btn btn-success btn-lg mt-3">Dodaj do koszyka</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const imgElement = document.getElementById("productImage");
        const variantInput = document.getElementById("selectedVariantId");
        const priceInput = document.getElementById("selectedPrice");

        document.querySelectorAll(".color-swatch").forEach(swatch => {
            swatch.addEventListener("click", () => {
                const img = swatch.dataset.img;
                const variantId = swatch.dataset.variant;
                const price = swatch.dataset.price;

                imgElement.src = img;
                variantInput.value = variantId;

                if (price) {
                    document.getElementById("productPrice").textContent = parseFloat(price).toFixed(2);
                    priceInput.value = parseFloat(price).toFixed(2);
                }

                document.querySelectorAll(".color-swatch").forEach(s => s.classList.remove("active"));
                swatch.classList.add("active");
            });
        });
    </script>
}

<style>
    .color-swatch {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid #ccc;
        cursor: pointer;
        transition: transform 0.2s, border-color 0.2s;
    }

        .color-swatch:hover {
            transform: scale(1.2);
            border-color: #007bff;
        }

        .color-swatch.active {
            border-color: #007bff;
            box-shadow: 0 0 5px #007bff;
        }
</style>
